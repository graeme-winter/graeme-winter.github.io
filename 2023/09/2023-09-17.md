# Kernel Modules

One of the great things about the Ï€ is the ability to hack at the lowest levels, and break something which doesn't matter. In addition to exploring bare metal on BCM2835, also started to look at writing kernel modules, since that is the usual MO for interfacing to hardware.

Spoiler: the kernel makes this harder, because its job is to stop you from messing with hardware. This is fine, but meant that the writing of a new kernel module was something of a learning curve. As such, work with something with which I am already familiar, GPCLK as per [previous user space investigations](../07/2023-07-04.md).

## Kernel Basics

In UNIX everything is a file, so if you want to expose a device, you create a file to do so. The file in this case lives under `/dev`, and wants to expose a clock divider register - I will assume that the clock has been set up as per the data sheet in advance (I used the user space program from before).

Device file needs to deal with four ideas:

- activity when opened
- activity when released (closed)
- action on read
- action on write

These four functions are essentially what defines the minimal functionality exposed by a character device. The API for these (i.e. stubs) is well documented, but the _behaviour_ expected from these is less well documented.
