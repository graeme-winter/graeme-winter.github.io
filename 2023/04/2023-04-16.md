# Clocks Again

Working through some more what the clocks are good for, now trying to see what the output looks like and how I can use this as input to the DAC / DMA (which is what I was actually trying to achieve.) The basic idea is very simple here - create a general clock connected to one of the main clock sources, then connect that to a peripheral (TCC1, in my case) which allows connection to the LED at D13 / PA22. N.B. the connections on the outside ATSAMD51G19A are very limited, and not many offer function M which is `GCLK_IO` output from a "useful" clock.

## Code

Goal: hook up output to LED / GPIO such that oscilloscope trace is reachable, at some fixed divider:

```python
from machine import mem32

# base addresses
GCLK_BASE = 0x40001C00
PORT_BASE = 0x41008000
TCC1_BASE = 0x41018000

# set up LED on D13 / PA22 connected to TCC which is mode F (i.e. 5)
# looks like can also hook to CCL - set as out then WRCONFIG the PMUX

mem32[PORT_BASE | 0x8] = 0x1 << 22
mem32[PORT_BASE | 0x28] = 0b10010101000000010000000000000110

# hook up 48 MHz clock
mem32[GCLK_BASE | 0x80 | 100] = 68
mem32[GCLK_BASE | 0x20 | 16] = (0x1 << 16) | (0x1<<11) | (0x1 << 8) | 0x6

# configure TCC1
mem32[TCC1_BASE | 0x3C] = 2
mem32[TCC1_BASE | 0x40] = 47
mem32[TCC1_BASE | 0x4C] = 24

mem32[TCC1_BASE] = 0x2
```

N.B. `0b10010101000000010000000000000110` derived from reading table at ยง32.8.11 and typing 0, 1 at the right times. Upper side of register to update (because PA22), not writing the pin configuration register, am changing the PMUX register, enabling PMUX and writing to pin (22 - 16) i.e. 6.

Otherwise this configures clock #4 (which I found is not usually configured) at 48MHz connected off source 6 which seems pretty universal, then sets TCCO to count `0...47` inclusive before overflow. Result on D13:

![Oscilloscope trace](./F0006TEK.png)

Which looks like what I wanted. No crystal on this board to there is a little frequency drift...
